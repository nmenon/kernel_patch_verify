From 7a73123371435848f0ef421ddc9a39205fd592a3 Mon Sep 17 00:00:00 2001
From: Nishanth Menon <nm@ti.com>
Date: Fri, 20 Feb 2026 06:26:27 -0600
Subject: [PATCH] kernel: scripts: agent/review: Provide directory and file
 edit permissions

Provide directory permissions for claude to be able to read review
prompt.

For example:
<path>/review-prompts/kernel/scripts/agent_one.sh \
--linux <path_to_linux> some_sha_2dfa15ee743445436ee271d40e033deeccc3a13

I get:
I need permission to read the review-core.md file. Could you grant
access to that file? In the meantime, let me proceed with a regression
analysis of the commit based on what I can see.

Solutions such as providing a wrapper script with --cli would not
cleanly work. Instead, just provide the path required.

Once we get past the folder permission challenge, we see:

Note: I was unable to write the review-metadata.json file due to
permission restrictions. The JSON content would be:

```json
{
  "author": "Some Developer <dev@ti.com>",
  "sha": "92dfa15ee743445436ee271d40e033deeccc3a13",
  "subject": "arm64: dts: ti: k3-am62d2-evm: Add some XYZ support",
  "AI-authorship-score": "low",
  "AI-authorship-explanation": "The commit follows standard kernel DTS patterns with hardware-specific details and documentation references typical of hardware engineer contributions.",
  "issues-found": 0,
  "issue-severity-score": "none",
  "issue-severity-explanation": "No issues were found in this device tree addition."
}
```
Allow file edit permissions for claude to generate the metadata file.

Signed-off-by: Nishanth Menon <nm@ti.com>
---
 kernel/scripts/agent_one.sh  | 4 ++++
 kernel/scripts/review_one.sh | 4 ++++
 2 files changed, 8 insertions(+)

diff --git a/kernel/scripts/agent_one.sh b/kernel/scripts/agent_one.sh
index 3559fd62feb9..3e710e2e320e 100755
--- a/kernel/scripts/agent_one.sh
+++ b/kernel/scripts/agent_one.sh
@@ -219,6 +219,10 @@ set_claude_opts() {
 
 	CLI_OPTS="--verbose"
 	CLI_OUT="--output-format=stream-json | tee $OUTFILE | $JSONPROG"
+	CLI_OPTS+=" --permission-mode acceptEdits"
+	CLI_OPTS+=" --add-dir /tmp"
+	CLI_OPTS+=" --add-dir $WORKING_DIR"
+	CLI_OPTS+=" --add-dir $SCRIPT_DIR/.."
 }
 
 set_copilot_opts() {
diff --git a/kernel/scripts/review_one.sh b/kernel/scripts/review_one.sh
index 5678d61c4085..371c4744b285 100755
--- a/kernel/scripts/review_one.sh
+++ b/kernel/scripts/review_one.sh
@@ -215,6 +215,10 @@ set_claude_opts() {
 
 	CLI_OPTS="--verbose"
 	CLI_OUT="--output-format=stream-json | tee $OUTFILE | $JSONPROG"
+	CLI_OPTS+=" --permission-mode acceptEdits"
+	CLI_OPTS+=" --add-dir /tmp"
+	CLI_OPTS+=" --add-dir $WORKING_DIR"
+	CLI_OPTS+=" --add-dir $SCRIPT_DIR/.."
 }
 
 set_copilot_opts() {
-- 
2.47.0

